/* 请使用当前节点所选择的数据库语法编写SQL */ 
DELETE FROM `ads`.`ads_hub_dashboard_data` WHERE createtime = DATE_SUB(CURDATE(), INTERVAL 1 DAY);
INSERT INTO `ads`.`ads_hub_dashboard_data`
SELECT FROM_UNIXTIME(d.createtime/1000-6*3600,'%Y-%m-%d') as createtime,
       s.name,
       SUM(d.estpickupassignqty) as est_assign_collection,
       SUM(d.actpickupassignqty) as act_assigned_collection,
       SUM(d.excessivepickupassignqty) as unassigned_collection,
       SUM(d.delayedpickupassignqty) as delayed_assigned_collection,
       SUM(d.newestpickupqty) as est_pick_up,
       SUM(d.actpickupqty) as act_pick_up,
       SUM(d.excessivepickupqty) as failed_pick_up,
       SUM(d.nopickupbutentersiteqty) as missing_pick_up_scan,
       SUM(d.pickupandentersiteqty) as entersite,
       SUM(d.estinboundqty) as est_inbound,
       SUM(d.actinboundqty) as today_inbound,
       SUM(d.excessiveinboundqty) as excessive_inbound,
       SUM(d.delayinginboundqty) as delaying_inbound,
       SUM(d.estentersiteqty) as est_entersite,
       SUM(d.actentersiteqty) as today_entersite,
       SUM(d.reviewinbounduncommitqty) as inbound_uncommitted,
       SUM(d.reviewwaitingtobepaidqty) as waiting_to_be_paid,
       SUM(d.reviewinboundcommitqty) as inbound_committed,
       SUM(d.reviewhfuncommitqty) as hf_uncommitted,
       SUM(d.reviewhfcommitqty) as hf_committed,
       SUM(d.esttodayassigntaskqty) as est_assign_task,
       SUM(d.acttodayassigntaskqty) as act_assigned,
       SUM(d.unassigneddeliverytaskqty) as unassigned_delivery,
       SUM(d.assignexcessiveqty) as delayed_assigned_delivery,
       SUM(d.buffalodrivertotalunscantodispatchqty) as assigned_without_physical_scan,
       SUM(d.buffalodriverestdriversqty) as est_buffalo_drivers,
       CAST(AVG(d.buffalodriveractdriversqty) AS INT) as act_buffalo_drivers,
       SUM(d.buffalodriverwaitdispatchqty) as wait_to_dispatch_pick_orders,
       SUM(d.buffalodrivertodaydispatchqty) as pick_confirm,
       SUM(d.buffalodriverexcessivedispatchqty) as delayed_pick_confirm,
       SUM(d.buffalodrivertotalunsignedqty) as outstanding_pod,
       SUM(d.buffalodriversigned24hoursqty) as signed_rate_24_Hours,
       SUM(d.buffalodriversigned48hoursqty) as signed_rate_48_Hours,
       SUM(d.buffalodriverleavesitesignedqty) as signed_rate_denominator,
       SUM(d.buffalodriversignedqty) as buffalo_signed,
       SUM(d.buffalodriverdispatchingqty) as buffalo_dispatching,
       SUM(d.buffalodriverreturningqty) as buffalo_returning,
       SUM(d.buffalodriverreturnedqty) as buffalo_returned,
       SUM(d.couriertotalunscantodispatchfastwayqty) as third_courier_unscan_to_dispatch_fastway,
       SUM(d.couriertotalunscantodispatchskynetqty) as third_courier_unscan_to_dispatch_skynet,
       SUM(d.couriertotalunscantodispatchittqty) as third_courier_unscan_to_dispatch_itt,
       SUM(d.couriertotalunscantodispatchpaxiqty) as third_courier_unscan_to_dispatch_paxi,
       SUM(d.couriertotalunscantodispatchdpdlaserqty) as third_courier_unscan_to_dispatch_dpdlaser,
       SUM(d.courierestleavesitefastwayqty) as est_leavesite_fastway,
       SUM(d.courierestleavesiteskynetqty) as est_leavesite_skynet,
       SUM(d.courierestleavesiteittqty) as est_leavesite_itt,
       SUM(d.courierestleavesitepaxiqty) as est_leavesite_paxi,
       SUM(d.courierestleavesitedpdlaserqty) as est_leavesite_dpdlaser,
       SUM(d.couriertodayleavesitefastwayqty) as today_leavesite_fastway,
       SUM(d.couriertodayleavesiteskynetqty) as today_leavesite_skynet,
       SUM(d.couriertodayleavesiteittqty) as today_leavesite_itty,
       SUM(d.couriertodayleavesitepaxiqty) as today_leavesite_paxi,
       SUM(d.couriertodayleavesitedpdlaserqty) as today_leavesite_edpdlaser,
       SUM(d.courierexcessiveleavesitefastwayqty) as excessive_leavesite_fastway,
       SUM(d.courierexcessiveleavesiteskynetqty) as excessive_leavesite_skynet,
       SUM(d.courierexcessiveleavesiteittqty) as excessive_leavesite_itt,
       SUM(d.courierexcessiveleavesitepaxiqty) as excessive_leavesite_paxi,
       SUM(d.courierexcessiveleavesitedpdlaserqty) as excessive_leavesite_dpdlaser,
       SUM(d.clientcollecttotaluncollectqty) as total_client_uncollect,
       SUM(d.clientcollectactcollectqty) as act_client_collect,
       CAST(AVG(d.transitpackagewaittotransitbagqty) AS INT) as wait_to_bag_departure,
       CAST(AVG(d.transitpackagetodaytransitbagqty) AS INT) as actual_bag_departure,
       SUM(d.transitpackageexcessivetransitbagqty) as excessive_bag_departure
FROM `dwd`.`hubdashboarddata` d
LEFT JOIN `buffaloex_delivery`.`storehouse` s
ON d.hubid = s.id
WHERE FROM_UNIXTIME(d.createtime/1000-6*3600,'%Y-%m-%d') = DATE_SUB(CURDATE(), INTERVAL 1 DAY)
GROUP BY FROM_UNIXTIME(d.createtime/1000-6*3600,'%Y-%m-%d'),s.name
